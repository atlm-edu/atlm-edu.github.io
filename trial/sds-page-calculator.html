<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDS-PAGE Molecular Weight Calculator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
        }
        .standard-row {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }
        .result-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
        }
        canvas {
            max-width: 100%;
            height: 400px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
        }
        .quality-badge {
            font-size: 0.9em;
            padding: 5px 15px;
        }
        .formula-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <div class="header text-center">
                <h1><i class="fas fa-flask me-2"></i>SDS-PAGE Molecular Weight Calculator</h1>
                <p class="mb-0">Determine protein molecular weight using gel electrophoresis migration data</p>
            </div>
            
            <div class="p-4">
                <div class="row">
                    <!-- Standard Proteins Section -->
                    <div class="col-lg-6 mb-4">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-dna me-2"></i>Standard Proteins</h5>
                            </div>
                            <div class="card-body">
                                <div id="standardsContainer"></div>
                                <button class="btn btn-success w-100 mt-2" onclick="addStandardRow()">
                                    <i class="fas fa-plus me-2"></i>Add Standard
                                </button>
                                
                                <div class="alert alert-info mt-3" role="alert">
                                    <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>About Rf</h6>
                                    <p class="mb-0">
                                        <strong>Rf = Migration distance of protein / Migration distance of dye front</strong><br>
                                        <small>Enter migration distances in mm. Rf will be calculated automatically (range: 0-1)</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Unknown Protein Section -->
                    <div class="col-lg-6 mb-4">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Unknown Protein</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Migration Distance of Protein (mm)</label>
                                    <input type="number" class="form-control" id="unknownDistance" 
                                           placeholder="e.g., 45" step="0.1" onchange="calculateUnknownRf()">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Migration Distance of Dye Front (mm)</label>
                                    <input type="number" class="form-control" id="unknownDyeDistance" 
                                           placeholder="e.g., 67" step="0.1" onchange="calculateUnknownRf()">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Calculated Rf</label>
                                    <input type="text" class="form-control bg-light" id="unknownRf" readonly>
                                    <small class="text-muted">Auto-calculated from distances above</small>
                                </div>
                                
                                <button class="btn btn-primary w-100 btn-lg mt-3" onclick="calculate()">
                                    <i class="fas fa-calculator me-2"></i>Calculate Molecular Weight
                                </button>
                                
                                <div class="alert alert-warning mt-3" role="alert">
                                    <h6 class="alert-heading"><i class="fas fa-lightbulb me-2"></i>Tips</h6>
                                    <ul class="mb-0 small">
                                        <li>Use at least 3 standard proteins</li>
                                        <li>Ensure r² > 0.99 for reliable results</li>
                                        <li>Unknown should be within linear range</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div class="card border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Results & Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div id="resultsContainer">
                            <p class="text-muted text-center py-5">
                                <i class="fas fa-arrow-up fa-3x mb-3 d-block"></i>
                                Enter standard protein data and calculate to see results
                            </p>
                        </div>
                        <div class="mt-4">
                            <canvas id="chartCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let standardCounter = 0;
        
        function addStandardRow() {
            standardCounter++;
            const container = document.getElementById('standardsContainer');
            const row = document.createElement('div');
            row.className = 'standard-row';
            row.id = `standard-${standardCounter}`;
            row.innerHTML = `
                <div class="row g-2 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label small fw-bold">MW (kD)</label>
                        <input type="number" class="form-control mw-input" placeholder="250" step="0.1">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold">Protein Distance (mm)</label>
                        <input type="number" class="form-control protein-distance" placeholder="10" step="0.1" 
                               onchange="calculateStandardRf(${standardCounter})">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold">Dye Front (mm)</label>
                        <input type="number" class="form-control dye-distance" placeholder="67" step="0.1" 
                               onchange="calculateStandardRf(${standardCounter})">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small fw-bold">Rf</label>
                        <input type="text" class="form-control rf-input bg-light" readonly>
                    </div>
                    <div class="col-md-1">
                        <button class="btn btn-danger btn-sm w-100" onclick="removeRow(${standardCounter})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(row);
        }
        
        function calculateStandardRf(id) {
            const row = document.getElementById(`standard-${id}`);
            const proteinDist = parseFloat(row.querySelector('.protein-distance').value);
            const dyeDist = parseFloat(row.querySelector('.dye-distance').value);
            
            if (proteinDist && dyeDist && dyeDist > 0) {
                const rf = (proteinDist / dyeDist).toFixed(3);
                row.querySelector('.rf-input').value = rf;
            } else {
                row.querySelector('.rf-input').value = '';
            }
        }
        
        function removeRow(id) {
            document.getElementById(`standard-${id}`).remove();
        }
        
        function calculateUnknownRf() {
            const dist = parseFloat(document.getElementById('unknownDistance').value);
            const dye = parseFloat(document.getElementById('unknownDyeDistance').value);
            
            if (dist && dye && dye > 0) {
                const rf = (dist / dye).toFixed(3);
                document.getElementById('unknownRf').value = rf;
            } else {
                document.getElementById('unknownRf').value = '';
            }
        }
        
        function calculate() {
            const standards = [];
            const rows = document.querySelectorAll('.standard-row');
            
            rows.forEach(row => {
                const mw = parseFloat(row.querySelector('.mw-input').value);
                const rf = parseFloat(row.querySelector('.rf-input').value);
                
                if (mw && rf) {
                    standards.push({ mw, rf, logMW: Math.log10(mw) });
                }
            });
            
            if (standards.length < 3) {
                alert('⚠️ Please enter at least 3 standard proteins for accurate calculation.');
                return;
            }
            
            const unknownRf = parseFloat(document.getElementById('unknownRf').value);
            if (!unknownRf) {
                alert('⚠️ Please enter migration distances for the unknown protein.');
                return;
            }
            
            // Linear regression
            const n = standards.length;
            const sumX = standards.reduce((sum, s) => sum + s.rf, 0);
            const sumY = standards.reduce((sum, s) => sum + s.logMW, 0);
            const sumXY = standards.reduce((sum, s) => sum + s.rf * s.logMW, 0);
            const sumX2 = standards.reduce((sum, s) => sum + s.rf * s.rf, 0);
            const sumY2 = standards.reduce((sum, s) => sum + s.logMW * s.logMW, 0);
            
            const m = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const b = (sumY - m * sumX) / n;
            
            // Calculate r²
            const yMean = sumY / n;
            const ssTotal = standards.reduce((sum, s) => sum + Math.pow(s.logMW - yMean, 2), 0);
            const ssResidual = standards.reduce((sum, s) => {
                const predicted = m * s.rf + b;
                return sum + Math.pow(s.logMW - predicted, 2);
            }, 0);
            const r2 = 1 - (ssResidual / ssTotal);
            
            // Calculate unknown MW
            const unknownLogMW = m * unknownRf + b;
            const unknownMW = Math.pow(10, unknownLogMW);
            
            displayResults(m, b, r2, unknownMW, unknownRf, standards);
            drawChart(standards, m, b, unknownRf, unknownMW);
        }
        
        function displayResults(m, b, r2, mw, rf, standards) {
            const resultsDiv = document.getElementById('resultsContainer');
            
            let quality = 'Excellent';
            let qualityClass = 'success';
            if (r2 < 0.99) { quality = 'Good'; qualityClass = 'warning'; }
            if (r2 < 0.95) { quality = 'Fair'; qualityClass = 'warning'; }
            if (r2 < 0.90) { quality = 'Poor'; qualityClass = 'danger'; }
            
            // Get unknown protein distances for calculation display
            const unknownDist = parseFloat(document.getElementById('unknownDistance').value);
            const unknownDyeDist = parseFloat(document.getElementById('unknownDyeDistance').value);
            
            resultsDiv.innerHTML = `
                <div class="result-box">
                    <h4 class="mb-3"><i class="fas fa-check-circle me-2"></i>Calculation Results</h4>
                    
                    <div class="formula-box">
                        <strong>Linear Regression Equation:</strong><br>
                        <div id="equation1"></div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="formula-box">
                                <strong>Correlation (r²):</strong><br>
                                <span class="fs-4">${r2.toFixed(4)}</span>
                                <span class="badge bg-${qualityClass} quality-badge ms-2">${quality}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="formula-box">
                                <strong>Number of Standards:</strong><br>
                                <span class="fs-4">${standards.length}</span>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3 border-light">
                    
                    <h5 class="mb-3"><i class="fas fa-calculator me-2"></i>Step-by-Step Calculation</h5>
                    
                    <div class="formula-box">
                        <strong>Step 1: Calculate Unknown Rf</strong><br>
                        <div id="rfCalc"></div>
                    </div>
                    
                    <div class="formula-box">
                        <strong>Step 2: Calculate log MW</strong><br>
                        <div id="logMwCalc"></div>
                    </div>
                    
                    <div class="formula-box">
                        <strong>Step 3: Calculate MW</strong><br>
                        <div id="mwCalc"></div>
                    </div>
                    
                    <div class="alert alert-light mt-3 mb-0">
                        <h4 class="alert-heading text-dark">
                            <i class="fas fa-star me-2"></i>Final Result
                        </h4>
                        <hr>
                        <p class="fs-3 fw-bold text-dark mb-0">
                            Molecular Weight = ${mw.toFixed(2)} kD
                        </p>
                    </div>
                </div>
            `;
            
            // Render MathJax formulas
            setTimeout(() => {
                document.getElementById('equation1').innerHTML = `
                    $$y = ${m.toFixed(4)}x + ${b.toFixed(4)}$$
                    $$\\text{where } y = \\log(MW) \\text{ and } x = R_f$$
                `;
                
                document.getElementById('rfCalc').innerHTML = `
                    $$R_f = \\frac{\\text{Migration distance of protein}}{\\text{Migration distance of dye front}}$$
                    $$R_f = \\frac{${unknownDist}}{${unknownDyeDist}} = ${rf.toFixed(3)}$$
                `;
                
                document.getElementById('logMwCalc').innerHTML = `
                    $$\\log(MW) = ${m.toFixed(4)} \\times ${rf.toFixed(3)} + ${b.toFixed(4)}$$
                    $$\\log(MW) = ${(m * rf).toFixed(4)} + ${b.toFixed(4)} = ${(m * rf + b).toFixed(4)}$$
                `;
                
                document.getElementById('mwCalc').innerHTML = `
                    $$MW = 10^{\\log(MW)} = 10^{${(m * rf + b).toFixed(4)}} = ${mw.toFixed(2)} \\text{ kD}$$
                `;
                
                MathJax.typesetPromise();
            }, 100);
        }
        
        function drawChart(standards, m, b, unknownRf, unknownMW) {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 600;
            canvas.height = 400;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            const maxLogMW = Math.max(...standards.map(s => s.logMW)) + 0.2;
            const minLogMW = Math.min(...standards.map(s => s.logMW)) - 0.2;
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = padding + (i / 10) * chartWidth;
                const y = padding + (i / 10) * chartHeight;
                
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
            }
            
            // Draw regression line
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const logMW0 = m * 0 + b;
            const logMW1 = m * 1 + b;
            const y0 = padding + chartHeight - ((logMW0 - minLogMW) / (maxLogMW - minLogMW)) * chartHeight;
            const y1 = padding + chartHeight - ((logMW1 - minLogMW) / (maxLogMW - minLogMW)) * chartHeight;
            ctx.moveTo(padding, y0);
            ctx.lineTo(padding + chartWidth, y1);
            ctx.stroke();
            
            // Draw standard points
            standards.forEach(s => {
                const x = padding + s.rf * chartWidth;
                const y = padding + chartHeight - ((s.logMW - minLogMW) / (maxLogMW - minLogMW)) * chartHeight;
                
                ctx.fillStyle = '#28a745';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            // Draw unknown point
            const unknownX = padding + unknownRf * chartWidth;
            const unknownLogMW = Math.log10(unknownMW);
            const unknownY = padding + chartHeight - ((unknownLogMW - minLogMW) / (maxLogMW - minLogMW)) * chartHeight;
            
            ctx.fillStyle = '#dc3545';
            ctx.beginPath();
            ctx.arc(unknownX, unknownY, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Rf (Relative Migration)', padding + chartWidth / 2, canvas.height - 10);
            
            ctx.save();
            ctx.translate(15, padding + chartHeight / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('log MW', 0, 0);
            ctx.restore();
            
            // Axis numbers
            ctx.font = '12px Arial';
            ctx.fillStyle = '#666';
            for (let i = 0; i <= 10; i++) {
                const rf = (i / 10).toFixed(1);
                const x = padding + (i / 10) * chartWidth;
                ctx.textAlign = 'center';
                ctx.fillText(rf, x, padding + chartHeight + 20);
                
                const logMW = minLogMW + (i / 10) * (maxLogMW - minLogMW);
                const y = padding + chartHeight - (i / 10) * chartHeight;
                ctx.textAlign = 'right';
                ctx.fillText(logMW.toFixed(1), padding - 10, y + 4);
            }
            
            // Legend
            ctx.font = '14px Arial';
            ctx.fillStyle = '#28a745';
            ctx.beginPath();
            ctx.arc(padding + 20, 30, 5, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#333';
            ctx.textAlign = 'left';
            ctx.fillText('Standards', padding + 30, 35);
            
            ctx.fillStyle = '#dc3545';
            ctx.beginPath();
            ctx.arc(padding + 130, 30, 6, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#333';
            ctx.fillText('Unknown', padding + 142, 35);
        }
        
        // Initialize with example data
        window.onload = function() {
            const defaultStandards = [
                { mw: 250, proteinDist: 10, dyeDist: 67 },
                { mw: 150, proteinDist: 17, dyeDist: 67 },
                { mw: 100, proteinDist: 23, dyeDist: 67 },
                { mw: 75, proteinDist: 30, dyeDist: 67 },
                { mw: 50, proteinDist: 37, dyeDist: 67 },
                { mw: 37, proteinDist: 44, dyeDist: 67 },
                { mw: 25, proteinDist: 50, dyeDist: 67 }
            ];
            
            defaultStandards.forEach((std, idx) => {
                addStandardRow();
                const row = document.getElementById(`standard-${standardCounter}`);
                row.querySelector('.mw-input').value = std.mw;
                row.querySelector('.protein-distance').value = std.proteinDist;
                row.querySelector('.dye-distance').value = std.dyeDist;
                calculateStandardRf(standardCounter);
            });
            
            // Set example unknown
            document.getElementById('unknownDistance').value = 45;
            document.getElementById('unknownDyeDistance').value = 67;
            calculateUnknownRf();
        };
    </script>
</body>
</html>